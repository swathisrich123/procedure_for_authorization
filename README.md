
CREATE OR REPLACE PROCEDURE P_AUTHORIZATION
(
IN IN_P1 INT DEFAULT 0,
IN IN_P2 INT DEFAULT 250,
IN IN_P3 VARCHAR(60) DEFAULT '',
IN IN_P4 VARCHAR(50) DEFAULT '',
IN IN_P5 VARCHAR(60) DEFAULT '', 
IN IN_P6 VARCHAR(60) DEFAULT '',
IN IN_P7 VARCHAR(60) DEFAULT '',
IN IN_P8 VARCHAR(60) DEFAULT '',
IN IN_P9 VARCHAR(50) DEFAULT '', 
IN IN_P10 BIGINT DEFAULT 0,
IN IN_P11 BIGINT DEFAULT 0,
OUT OUT_P1 VARCHAR(6000) )


SPECIFIC P_AUTHORIZATION 
DYNAMIC RESULT SETS 1
BEGIN
DECLARE V1,
V2,
V3,
V4,
V5,
V6,
V7,
V8,
V9 VARCHAR(256) DEFAULT';


DECLARE V10 BIGINT DEFAULT 0;

DECLARE V11,
V12,
V13 VARCHAR(6000) DEFAULT '';


DECLARE C1 CURSOR FOR V14;

IF IN_P3 != '' THEN SET V1 = 'AND T3.FY = '''||IN_P3 ||''' ';
END IF;


IF IN_P4 != '' THEN SET V2 = 'AND upper (T1. COL4) like upper(''%' || IN_P4 || '%'') '; 

END IF;


IF IN_P5 != '' THEN SET V3 = ' AND TRUNC (T1.COL5) >= TO_DATE(''' || IN_P5 || ''',''YYYY-MM-DD'') ';

END IF;



IF IN_P6 != '' THEN SET V4 = ' AND TRUNC(T1.COL5) <= TO_DATE(''' || IN_P6 ||''',''YYYYY-MM-DD'') '; 
END IF;


IF IN_P7 != '' THEN SET V5 = ' AND TRUNC (T1. COL6) >= TO_DATE( ''' || IN_P7 || ''',''YYYY-MM-DD'')';
END IF;


IF IN_P8 != '' THEN SET V6 = ' AND TRUNC (T1. COL6) <= TO_DATE( ''' || IN_P8 || ''',''YYYY-MM-DD'')';
END IF;


IF IN_P9 != '' THEN SET V7 = ' AND T1.COL7 = ''' || IN_P9 || ''' ';
END IF;

IF IN_P10 != 0 THEN SET V8 = ' AND T1.COL1 = ' || IN_P10 || ''; 
END IF;


IF IN_P11 <> 0 THEN SET V9 = 'AND T1.COL8= ' || IN_P11 || ' '; 
END IF;

SET V13 = ' FROM TABLE1 T1
INNER JOIN TABLE2 T2 ON T2.COL1 = T2.COL1 
INNER JOIN TABLE3 T3 ON 
T1.COL2=T3.COL1 
WHERE T1.COL1 IS NOT NULL
AND T1.COL3 = ll ' || V1 | V2 || V3 || V4 || V5 ';


SET V11 =
'SELECT COUNT(distinct TC.COL4) ' || V13;


PREPARE V14
FROM V11;


OPEN C1;


FETCH C1
INTO
V10;


CLOSE C1;


CURSOR:
BEGIN
DECLARE C2 CURSOR WITH RETURN FOR OUT_P1;


SET V12= 'select distinct
T1.COL4 ,
T3.FY ,
to char(T1.COL5, 'dd-Mon-yyyy), 
TO CHAR(T1. COL6,''dd-Mon-yyyy''), 
T2.COL2 "Status",|| V10 || v13 || 'ORDER BY to char (TC.COL5,''dd-Mon-yyyy'')
 FETCH NEXT ' || IN PAGE SIZE || ' ROWS ONLY WITH UR ';



PREPARE OUT_P1
FROM V12;


OPEN C2;
END CURSOR;
END;



